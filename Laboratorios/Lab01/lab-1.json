{"paragraphs":[{"title":"Imports","text":"import org.apache.spark.rdd.RDD\nimport org.joda.time.DateTime\nimport org.joda.time.LocalDate\nimport au.com.bytecode.opencsv.CSVReader\nimport java.io.StringReader\nimport scalaj.http._\nimport scala.util.parsing.json._\n","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.rdd.RDD\nimport org.joda.time.DateTime\nimport org.joda.time.LocalDate\nimport au.com.bytecode.opencsv.CSVReader\nimport java.io.StringReader\nimport scalaj.http._\nimport scala.util.parsing.json._\n"}]},"apps":[],"jobName":"paragraph_1507173703130_-1029791396","id":"20160720-193407_10576745","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:18-0300","dateFinished":"2017-10-05T04:04:18-0300","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:101"},{"title":"Primer Parte: Funciones","text":"\n\n\n\ndef esLineaErronea(arr : Array[String]) : Boolean = {\n    \n    return (arr.length == 6)\n}\n\n/** Carga un archivo en memoria y retorna un RDD. \n  *  \n  *  @param \tfile\t\t\t\tPath al archivo \n  *  @return\tRDD[Array[String]]\tCada Array[String] tiene 6 elementos:\n  *  \t\t\t\t\t\t\t\tdate, doi, ip_code, country, city, coords\n */\ndef loadFile(file : String) : RDD[Array[String]] = {\n    val lines = sc.textFile(file)\n    val RDDArr = lines.map(_.split(\"\\t\"))\n    val RDDRet = RDDArr.filter(esLineaErronea)\n    return RDDRet\n}\n//loadFile(\"/home/elian/Escritorio/BigData/zeppeling/bin/scihub_data/dec2015.tab\").take(1)(0).length\n\n\n/** Carga una lista de archivos en memoria y retorna un unico \n  * RDD[Array[String]] con el contenido de todos los archivos. \n  *  \n  *  @param \tfiles\t\t\t\tLista de paths\n  *  @return\tRDD[Array[String]]\tCada Array[String] tiene 6 elementos:\n  *  \t\t\t\t\t\t\t\tdate, doi, ip_code, country, city, coords\n*/ \ndef loadDataset(files:List[String]) : RDD[Array[String]] ={\n    val rdd_empty = sc.emptyRDD[Array[String]]\n    val RDDs = files.map(loadFile).fold(rdd_empty)(_.union(_))\n    return RDDs\n}\n\n//loadDataset(List(\"/home/elian/Escritorio/BigData/zeppeling/bin/scihub_data/dec2015.tab\", \"/home/elian/Escritorio/BigData/zeppeling/bin/scihub_data/feb2016.tab\")).take(1)\n\n/** Transforma un RDD[Array(String)] en un RDD[(DateTime,Int)].\n  *  \n  *  @param \traw\t\t\t\t\tDataset \"crudo\" de sci-hub.\n  *  @return\tRDD[(LocalDate,Int)]\t\n */\ndef f(ar : Array[String]): LocalDate =  {\n    try{\n       var a = Integer.parseInt(ar(0))\n       var b = Integer.parseInt(ar(1))\n       var c = Integer.parseInt(ar(2))\n       return (new LocalDate(a, b, c))\n    } catch {\n        case e:Exception=>\n            println(\"error\")\n            return (new LocalDate(2002, 4, 4))\n    }\n}\n\ndef toDateTuple(raw: RDD[Array[String]]) : RDD[(LocalDate, Int)] = {\n    val date = raw.map(x => x(0).split(\" \")(0).split(\"-\"))\n    val RDDTuples = date.map(x => (f(x), 1))\n    \n    return RDDTuples\n}\n\n\n\ndef aggregateByDay(data :  RDD[(LocalDate, Int)]) : RDD[(LocalDate, Int)] = {\n    val RDDRet = data.reduceByKey(_ + _)\n    return RDDRet\n}\n\ndef aggregateByMonth(data :  RDD[(LocalDate, Int)]) : RDD[(LocalDate, Int)] = {\n    val RDDMonths = data.map(x => (new LocalDate(x._1.getValue(0), x._1.getValue(1), 1), 1))\n    val RDDRet = RDDMonths.reduceByKey(_ + _)\n    return RDDRet\n}\n\ndef aggregateByWeekDay(data :  RDD[(LocalDate, Int)]) : RDD[(Int, Int)]  = {\n    val RDDDays = data.map(x => (x._1.getDayOfWeek(), 1))\n    val RDDRet = RDDDays.reduceByKey(_ + _)\n    return RDDRet\n}\n","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"esLineaErronea: (arr: Array[String])Boolean\nloadFile: (file: String)org.apache.spark.rdd.RDD[Array[String]]\nloadDataset: (files: List[String])org.apache.spark.rdd.RDD[Array[String]]\nf: (ar: Array[String])org.joda.time.LocalDate\ntoDateTuple: (raw: org.apache.spark.rdd.RDD[Array[String]])org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)]\naggregateByDay: (data: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)])org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)]\naggregateByMonth: (data: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)])org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)]\naggregateByWeekDay: (data: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)])org.apache.spark.rdd.RDD[(Int, Int)]\n"}]},"apps":[],"jobName":"paragraph_1507173703133_-1032484639","id":"20160828-194457_160895440","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:18-0300","dateFinished":"2017-10-05T04:04:19-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:102"},{"title":"Primera Parte: Ejecucion","text":"val sep = \"/home/elian/Escritorio/BigData/scihub_data/sep2015.tab\"\nval oct = \"/home/elian/Escritorio/BigData/scihub_data/oct2015.tab\"\nval nov = \"/home/elian/Escritorio/BigData/scihub_data/nov2015.tab\"\nval dec = \"/home/elian/Escritorio/BigData/scihub_data/dec2015.tab\"\nval jan = \"/home/elian/Escritorio/BigData/scihub_data/jan2016.tab\"\nval feb = \"/home/elian/Escritorio/BigData/scihub_data/feb2016.tab\"\n\n\n\n\nval dataSet = loadDataset(List(sep,oct,nov,dec,jan,feb))\n\nval data = toDateTuple(dataSet)\nval byDay = aggregateByDay(data)\nval byMonth = aggregateByMonth(data)\nval byWeekDay = aggregateByWeekDay(data)","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sep: String = /home/elian/Escritorio/BigData/scihub_data/sep2015.tab\noct: String = /home/elian/Escritorio/BigData/scihub_data/oct2015.tab\nnov: String = /home/elian/Escritorio/BigData/scihub_data/nov2015.tab\ndec: String = /home/elian/Escritorio/BigData/scihub_data/dec2015.tab\njan: String = /home/elian/Escritorio/BigData/scihub_data/jan2016.tab\nfeb: String = /home/elian/Escritorio/BigData/scihub_data/feb2016.tab\ndataSet: org.apache.spark.rdd.RDD[Array[String]] = UnionRDD[733] at union at <console>:87\ndata: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)] = MapPartitionsRDD[735] at map at <console>:80\nbyDay: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)] = ShuffledRDD[736] at reduceByKey at <console>:107\nbyMonth: org.apache.spark.rdd.RDD[(org.joda.time.LocalDate, Int)] = ShuffledRDD[738] at reduceByKey at <console>:106\nbyWeekDay: org.apache.spark.rdd.RDD[(Int, Int)] = ShuffledRDD[740] at reduceByKey at <console>:106\n"}]},"apps":[],"jobName":"paragraph_1507173703134_-1031330392","id":"20160830-101603_128796092","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:19-0300","dateFinished":"2017-10-05T04:04:20-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:103"},{"title":"Descargas x Dia","text":"val table1 = \"\"\nprintln(\"%table Date\\tDownloads\\n\" + table1)\nbyDay.collect.foreach{case (w,c) => println(\"\\\"\" + w + \"\\\"\" + \"\\t\" + c)}\n","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"stackedAreaChart","height":300,"optionOpen":false,"keys":[{"name":"Date","index":0,"aggr":"sum"}],"values":[{"name":"Downloads","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Date","index":0,"aggr":"sum"},"yAxis":{"name":"Downloads","index":1,"aggr":"sum"}}}},{"graph":{"mode":"stackedAreaChart","height":300,"optionOpen":false},"helium":{}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table1: String = \"\"\n"},{"type":"TABLE","data":"Date\tDownloads\n\"2015-09-24\"\t161953\n\"2016-01-19\"\t199521\n\"2015-10-10\"\t175451\n\"2016-02-05\"\t178126\n\"2016-01-30\"\t137935\n\"2016-02-16\"\t255052\n\"2015-10-21\"\t221229\n\"2016-02-27\"\t191950\n\"2015-11-29\"\t109454\n\"2015-12-04\"\t141592\n\"2015-12-15\"\t179622\n\"2015-09-06\"\t121198\n\"2016-01-01\"\t87277\n\"2015-09-17\"\t182311\n\"2016-01-12\"\t182815\n\"2015-12-26\"\t99907\n\"2016-01-23\"\t158933\n\"2015-09-28\"\t205225\n\"2015-10-03\"\t125717\n\"2015-10-14\"\t236997\n\"2016-02-09\"\t187652\n\"2015-10-25\"\t162015\n\"2016-02-20\"\t194618\n\"2015-11-22\"\t39967\n\"2015-12-08\"\t162162\n\"2015-09-10\"\t168581\n\"2015-12-19\"\t113947\n\"2016-01-05\"\t172209\n\"2016-01-16\"\t127633\n\"2015-09-21\"\t217846\n\"2015-12-30\"\t140105\n\"2016-02-02\"\t198192\n\"2015-10-07\"\t196240\n\"2016-01-27\"\t198213\n\"2016-02-13\"\t207334\n\"2015-10-18\"\t159507\n\"2015-10-29\"\t216588\n\"2016-02-24\"\t287524\n\"2015-11-04\"\t137325\n\"2015-11-26\"\t125278\n\"2015-12-01\"\t159110\n\"2015-09-03\"\t164475\n\"2015-12-12\"\t123507\n\"2015-09-14\"\t181225\n\"2015-12-23\"\t57566\n\"2016-01-09\"\t121763\n\"2016-01-20\"\t197684\n\"2015-09-25\"\t159892\n\"2016-02-06\"\t143356\n\"2016-01-31\"\t121819\n\"2015-10-11\"\t164789\n\"2016-02-17\"\t250275\n\"2015-10-22\"\t206038\n\"2016-02-28\"\t197995\n\"2015-12-05\"\t115699\n\"2015-11-30\"\t152988\n\"2015-09-07\"\t126391\n\"2016-01-02\"\t112029\n\"2015-12-16\"\t197410\n\"2016-01-13\"\t173148\n\"2015-09-18\"\t136835\n\"2016-01-24\"\t147636\n\"2015-10-04\"\t130392\n\"2015-09-29\"\t201481\n\"2015-10-15\"\t228642\n\"2016-02-10\"\t192981\n\"2016-02-21\"\t201729\n\"2015-11-01\"\t158860\n\"2015-10-26\"\t239419\n\"2015-11-23\"\t132895\n\"2015-12-09\"\t166353\n\"2015-12-20\"\t117865\n\"2015-09-11\"\t178039\n\"2016-01-06\"\t119157\n\"2015-09-22\"\t195031\n\"2016-01-17\"\t134223\n\"2015-12-31\"\t107062\n\"2015-10-08\"\t219405\n\"2016-02-03\"\t200592\n\"2016-01-28\"\t189977\n\"2015-10-19\"\t234930\n\"2016-02-14\"\t163895\n\"2015-10-30\"\t203869\n\"2016-02-25\"\t285294\n\"2015-11-27\"\t126436\n\"2015-12-02\"\t159873\n\"2015-12-13\"\t110384\n\"2015-09-04\"\t141425\n\"2015-09-15\"\t179402\n\"2015-12-24\"\t81695\n\"2016-01-10\"\t126172\n\"2015-10-01\"\t163759\n\"2015-09-26\"\t119559\n\"2016-01-21\"\t198652\n\"2016-02-07\"\t123561\n\"2015-10-12\"\t241172\n\"2015-10-23\"\t194017\n\"2016-02-18\"\t242040\n\"2016-02-29\"\t282656\n\"2015-12-06\"\t118645\n\"2016-01-03\"\t111728\n\"2015-09-08\"\t161909\n\"2015-12-17\"\t159985\n\"2015-12-28\"\t9534\n\"2015-09-19\"\t136283\n\"2016-01-14\"\t170317\n\"2015-09-30\"\t189749\n\"2015-10-05\"\t209610\n\"2016-01-25\"\t209929\n\"2016-02-11\"\t193218\n\"2015-10-16\"\t217571\n\"2016-02-22\"\t263404\n\"2015-11-02\"\t242674\n\"2015-10-27\"\t235817\n\"2015-11-24\"\t139344\n\"2015-09-01\"\t259212\n\"2015-12-10\"\t163833\n\"2016-01-07\"\t132052\n\"2015-12-21\"\t159852\n\"2015-09-12\"\t136263\n\"2015-09-23\"\t185905\n\"2016-01-18\"\t193387\n\"2015-10-09\"\t211024\n\"2016-02-04\"\t190509\n\"2016-01-29\"\t174113\n\"2015-10-20\"\t211899\n\"2016-02-15\"\t208310\n\"2016-03-01\"\t2\n\"2016-02-26\"\t258522\n\"2015-10-31\"\t157537\n\"2015-11-28\"\t98349\n\"2015-12-03\"\t153125\n\"2015-09-05\"\t91168\n\"2015-12-14\"\t99728\n\"2016-01-11\"\t177125\n\"2015-09-16\"\t191777\n\"2015-12-25\"\t87229\n\"2016-01-22\"\t219520\n\"2015-09-27\"\t125160\n\"2015-10-02\"\t144241\n\"2016-02-08\"\t184710\n\"2015-10-13\"\t238358\n\"2016-02-19\"\t228539\n\"2015-10-24\"\t144169\n\"2015-12-07\"\t160000\n\"2015-09-09\"\t106014\n\"2015-12-18\"\t143163\n\"2016-01-04\"\t163768\n\"2015-12-29\"\t60021\n\"2016-01-15\"\t157783\n\"2015-09-20\"\t135501\n\"2015-10-06\"\t202665\n\"2016-02-01\"\t200054\n\"2016-01-26\"\t199233\n\"2016-02-12\"\t224429\n\"2015-10-17\"\t151682\n\"2015-10-28\"\t227398\n\"2016-02-23\"\t276574\n\"2015-11-03\"\t250108\n\"2015-11-25\"\t135707\n\"2015-09-02\"\t216188\n\"2015-12-11\"\t160983\n\"2015-09-13\"\t128320\n\"2016-01-08\"\t85761\n\"2015-12-22\"\t169552\n"}]},"apps":[],"jobName":"paragraph_1507173703136_-1045950850","id":"20160829-212142_1138855898","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:19-0300","dateFinished":"2017-10-05T04:04:39-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:104"},{"title":"Descargas x Mes","text":"val table2 = \"\"\n\nprintln(\"%table Month\\tDownloads\\n\" + table2)\nbyMonth.collect.foreach{case (w,c) => println(\"\\\"\" + w.getValue(0)+\"-\"+w.getValue(1) + \"\\\"\" + \"\\t\" + c)}","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":6,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"Month","index":0,"aggr":"sum"}],"values":[{"name":"Downloads","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Month","index":0,"aggr":"sum"},"yAxis":{"name":"Downloads","index":1,"aggr":"sum"}}}},{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table2: String = \"\"\n"},{"type":"TABLE","data":"Month\tDownloads\n\"2016-1\"\t4901512\n\"2015-12\"\t3879509\n\"2015-11\"\t1849385\n\"2015-10\"\t6072147\n\"2015-9\"\t4904318\n\"2016-3\"\t2\n\"2016-2\"\t6213091\n"}]},"apps":[],"jobName":"paragraph_1507173703137_-1046335599","id":"20160829-212442_607988519","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:21-0300","dateFinished":"2017-10-05T04:04:56-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:105"},{"title":"Descargas x Dia de la Semana","text":"val table3 = \"\"\ndef dias(s:String):String={\n    s match {\n      case \"1\"  => return(\"lunes\")\n      case \"2\"  => return(\"martes\")\n      case \"3\"  => return(\"miercoles\")\n      case \"4\"  => return(\"jueves\")\n      case \"5\"  => return(\"viernes\")\n      case \"6\"  => return(\"sabado\")\n      case \"7\"  => return(\"domingo\")\n}\n    \n}\n\nprintln(\"%table Day\\tDownloads\\n\" + table3)\n\nbyWeekDay.takeOrdered(7)(Ordering[Int].on (_._1.toInt)).map(x => (dias(x._1.toString), x._2)).foreach{case (w,c) => println(\"\\\"\" + w + \"\\\"\" + \"\\t\" + c)}\n\n\n","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":6,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"Day","index":0,"aggr":"sum"}],"values":[{"name":"Downloads","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Day","index":0,"aggr":"sum"},"yAxis":{"name":"Downloads","index":1,"aggr":"sum"}}}},{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table3: String = \"\"\ndias: (s: String)String\n"},{"type":"TABLE","data":"Day\tDownloads\n\"lunes\"\t4496832\n\"martes\"\t4676943\n\"miercoles\"\t4385410\n\"jueves\"\t4104789\n\"viernes\"\t3860386\n\"sabado\"\t3184789\n\"domingo\"\t3110815\n"}]},"apps":[],"jobName":"paragraph_1507173703138_-1045181352","id":"20160829-212549_353556239","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:39-0300","dateFinished":"2017-10-05T04:05:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:106"},{"title":"Segunda Parte: Funciones","text":"/** Carga un archivo contiene el mapeo prefix -> publisher..foreach(println)\n*  \n*  @param \tfile\t\t\t\t\tPath al archivo.\n*  @return\tRDD[(String,String)] \t\n*/\n\n//una funcion que devuelve falso si la linea, antes de la primer coma, no es un numero\ndef removeHeader(line: String) : Boolean = {\n    val first = line.split(\",\")(0)\n    try{\n       var a = Integer.parseInt(first)\n       return (true)\n    } catch {\n        case e:Exception=>\n            return (false)\n    }\n}\n\n\ndef loadPrefixMapping(file : String) : RDD[(String, String)] = {\n    val lines = sc.textFile(file)\n    val linesWithOutHeader = lines.filter(removeHeader)\n    val RDDarr = linesWithOutHeader.map(x => new CSVReader(new StringReader(x), ',', '\"', 0).readAll().get(0))\n    \n    val resultado = RDDarr.map(arr => (arr(2), arr(1)))\n    return (resultado)\n}\n\ndef IDtoNAME(s : String, rdd : RDD[(String, String)]) : String = {\n    return rdd.lookup(s)(0)\n}\n\ndef filtrarErroneo(s:String) : Boolean = {\n    val arr = s.split(\"\\\\.\")\n    val l = arr.length\n    return l == 2\n}\n\ndef aggregateByPrefix(rdd : RDD[Array[String]],rddMapeo : RDD[(String, String)]) : RDD[(String, Int)] = {\n    val RDDIDs1 = rdd.map(x => (x(1).split(\"/\")(0), 1))\n    val RDDIDs = RDDIDs1.filter(x => filtrarErroneo(x._1))\n    //RDDIDs.take(10).foreach(println)\n    //RDDIDs.take(10).foreach(println)\n    //val rddPrefix = RDDIDs.map(x => (IDtoNAME(x._1, rddMapeo), 1))\n    val RDDRet1 = RDDIDs.reduceByKey(_ + _)\n    \n    \n    \n    \n    val RDDRet = RDDRet1.join(rddMapeo.distinct())\n    val h = RDDRet.map(x => (x._2._2, x._2._1))\n    \n    \n    \n    //val prueba = RDDRet.collect.map(x =>(IDtoNAME(x._1, rddMapeo), 1))\n    return(h)\n}\n\n\n\ndef aggregateByCountry(rdd : RDD[Array[String]]) : RDD[(String, Int)] = {\n    val RDDCountry = rdd.map(x => (x(3),1))\n    val RDDRet = RDDCountry.reduceByKey(_ + _)\n    return RDDRet\n}\n\ndef aggregateByDoi(rdd : RDD[Array[String]]) : RDD[(String, Int)] = {\n    val RDDDoi = rdd.map(x => (x(1),1))\n    val RDDRet = RDDDoi.reduceByKey(_ + _)\n    return RDDRet\n}\n\ndef getMetadata(doi : String) : Array[String] = {\n    \n    try{\n        val response = Http(\"https://data.crossref.org/\" ++ doi).header(\"Accept\",\"application/rdf+xml;q=0.5, application/vnd.citationstyles.csl+json;q=1.0\").asString.body.toString\n        val a = JSON.parseFull(response).get.asInstanceOf[Map[String,List[Map[String,String]]]]\n        \n        var title = \"\"\n        var year = \"\"\n        var publisher = \"\"\n        var book = \"\"\n        var subject = \"\"\n        var type1 = \"\"\n        try{\n            title = a(\"title\").asInstanceOf[String]\n        } catch {\n            case e:Exception=>\n            title = \"NoMetadatosDisponibles\"\n        }\n        \n        try{\n            year = a.asInstanceOf[Map[String,Map[String,List[List[Double]]]]](\"issued\")(\"date-parts\")(0)(0).toString.split(\"\\\\.\")(0)\n        } catch {\n            case e:Exception=>\n            year = \"NoMetadatosDisponibles\"\n        }\n        \n        try{\n            type1 = a(\"type\").asInstanceOf[String]\n        } catch {\n            case e:Exception=>\n            type1 = \"NoMetadatosDisponibles\"\n        }\n        \n        \n        try{\n            publisher = a(\"publisher\").asInstanceOf[String]\n        } catch {\n            case e:Exception=>\n            publisher = \"NoMetadatosDisponibles\"\n        }\n        \n        try{\n            book = a(\"container-title\").asInstanceOf[String]\n        } catch {\n            case e:Exception=>\n            book = \"NoMetadatosDisponibles\"\n        }\n        \n        try{\n            subject = a(\"subject\").asInstanceOf[List[String]](0)\n        } catch {\n            case e:Exception=>\n            subject = \"NoMetadatosDisponibles\"\n        }\n        val resultado = Array(title, year, type1, publisher, book, subject)\n        return (resultado)\n        \n    } catch {\n        case e:Exception=>\n        println(\"error al descargar metadatos! el servidor no responde\")\n        return (Array(\"error\", \"error\",\"error\",\"error\",\"error\", \"error\"))\n        // el error es causado por un timeout al descargar los metadatos. no los descarga\n    }\n}\n\ngetMetadata(\"10.1126/science.aad0135\")\n/*val response = Http(\"https://data.crossref.org/\" ++ \"10.1126/science.aad0135\").header(\"Accept\",\"application/rdf+xml;q=0.5, application/vnd.citationstyles.csl+json;q=1.0\").asString.body.toString\nprintln(\"  \")\nprintln(\"  \")\nprintln(\"  \")\nval a = JSON.parseFull(response).get.asInstanceOf[Map[String,List[Map[String,String]]]]\nprintln(\"  \")\nprintln(\"  \")\nprintln(\"  \")\nval y = a.asInstanceOf[Map[String,Map[String,List[List[Double]]]]](\"issued\")(\"date-parts\")(0)(0).toString.split(\"\\\\.\")(0)*/\n\n\n","user":"anonymous","dateUpdated":"2017-10-05T04:04:18-0300","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":216,"optionOpen":false}}},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"removeHeader: (line: String)Boolean\nloadPrefixMapping: (file: String)org.apache.spark.rdd.RDD[(String, String)]\nIDtoNAME: (s: String, rdd: org.apache.spark.rdd.RDD[(String, String)])String\nfiltrarErroneo: (s: String)Boolean\naggregateByPrefix: (rdd: org.apache.spark.rdd.RDD[Array[String]], rddMapeo: org.apache.spark.rdd.RDD[(String, String)])org.apache.spark.rdd.RDD[(String, Int)]\naggregateByCountry: (rdd: org.apache.spark.rdd.RDD[Array[String]])org.apache.spark.rdd.RDD[(String, Int)]\naggregateByDoi: (rdd: org.apache.spark.rdd.RDD[Array[String]])org.apache.spark.rdd.RDD[(String, Int)]\ngetMetadata: (doi: String)Array[String]\nres2003: Array[String] = Array(A gut-vascular barrier controls the systemic dissemination of bacteria, 2015, article-journal, American Association for the Advancement of Science (AAAS), Science, Multidisciplinary)\n"}]},"apps":[],"jobName":"paragraph_1507173703139_-1045566101","id":"20160720-200109_863303752","dateCreated":"2017-10-05T00:21:43-0300","dateStarted":"2017-10-05T04:04:57-0300","dateFinished":"2017-10-05T04:05:16-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:107"},{"title":"Segunda Parte: Ejecucion","text":"val pares = loadPrefixMapping(\"/home/elian/Escritorio/BigData/scihub_data/publisher_DOI_prefixes.csv\")\nval byPrefix = aggregateByPrefix(dataSet, pares).takeOrdered(10)(Ordering[Int].reverse.on (_._2))\nval byCountry = aggregateByCountry(dataSet).takeOrdered(10)(Ordering[Int].reverse.on (_._2))\nval byDoi = aggregateByDoi(dataSet).takeOrdered(10)(Ordering[Int].reverse.on (_._2))\n\ndef completarMetadatos(par:(String,Int)): (String, String, String, String, String, String, String, String) = {\n    val doi = par._1\n    val res = getMetadata(doi)\n    return ((doi, res(0), res(1), res(2), res(3), res(4), res(5), par._2.toString))\n}\n\nval DoiPlusMetadatos = byDoi.map(x => completarMetadatos(x))\n\n","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pares: org.apache.spark.rdd.RDD[(String, String)] = MapPartitionsRDD[746] at map at <console>:80\nbyPrefix: Array[(String, Int)] = Array((Elsevier,9296486), (Springer-Verlag,2621956), (Institute of Electrical and Electronics Engineers,2138064), (American Chemical Society,1871934), (Wiley Blackwell (John Wiley & Sons),1367250), (Nature Publishing Group,1121881), (The Royal Society of Chemistry,927239), (Informa UK (Taylor & Francis),906221), (Wiley Blackwell (Blackwell Publishing),814996), (SAGE Publications,377267))\nbyCountry: Array[(String, Int)] = Array((China,4456076), (India,3414582), (Iran,2631035), (Russia,1521434), (United States,1150963), (Brazil,1021540), (Egypt,801106), (Indonesia,780873), (N/A,562692), (France,511145))\nbyDoi: Array[(String, Int)] = Array((10.1007/978-1-4419-9716-6_11,7988), (10.1056/NEJMoa1402121,6117), (10.1116/1.4904970,2991), (10.1103/PhysRevB.63.224204,2890), (10.1182/asheducation-2015.1.8,2528), (10.4028/www.scientific.net/AMM.7-8.159,2266), (10.1111/j.1365-277X.2004.00520.x,2241), (10.1002/pmic.200600525,2168), (10.1161/CIRCRESAHA.117.306290,2001), (10.1002/smll.201002009,1806))\ncompletarMetadatos: (par: (String, Int))(String, String, String, String, String, String, String, String)\nDoiPlusMetadatos: Array[(String, String, String, String, String, String, String, String)] = Array((10.1007/978-1-4419-9716-6_11,Full-scale modal wind turbine tests: comparing shaker excitation with wind excitation,2011,chapter,Springer New York,Structural Dynamics and Renewable Energy, Volume 1,NoMetadatosDisponibles,7988), (10.1056/NEJMoa1402121,Comprehensive, Integrative Genomic Analysis of Diffuse Lower-Grade Gliomas,2015,article-journal,New England Journal of Medicine (NEJM/MMS),New England Journal of Medicine,General Medicine,6117), (10.1116/1.4904970,Photosensitive field emission study of SnS2 nanosheets,2015,article-journal,American Vacuum Society,Journal of Vacuum Science & Technology B, Nanotechnology and Microelectronics: Materials, Processing, Measurement, and Phenomena,Instr..."}]},"apps":[],"jobName":"paragraph_1507173703140_-1047489846","id":"20160830-191755_1665458610","dateCreated":"2017-10-05T00:21:43-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:108","user":"anonymous","dateFinished":"2017-10-05T04:07:01-0300","dateStarted":"2017-10-05T04:05:15-0300"},{"title":"Top 10 - Editoriales","text":"val table4 = \"\"\n\nprintln(\"%table Publisher\\tDownloads\\n\" + table4)\nbyPrefix.foreach{case (w,c) => println(\"\\\"\" + w + \"\\\"\" + \"\\t\" + c)}","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":6,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Publisher","index":0,"aggr":"sum"}],"values":[{"name":"Downloads","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Publisher","index":0,"aggr":"sum"},"yAxis":{"name":"Downloads","index":1,"aggr":"sum"}}}},{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table4: String = \"\"\n"},{"type":"TABLE","data":"Publisher\tDownloads\n\"Elsevier\"\t9296486\n\"Springer-Verlag\"\t2621956\n\"Institute of Electrical and Electronics Engineers\"\t2138064\n\"American Chemical Society\"\t1871934\n\"Wiley Blackwell (John Wiley & Sons)\"\t1367250\n\"Nature Publishing Group\"\t1121881\n\"The Royal Society of Chemistry\"\t927239\n\"Informa UK (Taylor & Francis)\"\t906221\n\"Wiley Blackwell (Blackwell Publishing)\"\t814996\n\"SAGE Publications\"\t377267\n"}]},"apps":[],"jobName":"paragraph_1507173703142_-1046720348","id":"20160814-113813_1049909467","dateCreated":"2017-10-05T00:21:43-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:109","user":"anonymous","dateFinished":"2017-10-05T04:07:02-0300","dateStarted":"2017-10-05T04:05:17-0300"},{"title":"Top 10 - Paises","text":"val table5 = \"\"\n        \nprintln(\"%table Country\\tDownloads\\n\" + table5)\nbyCountry.foreach{case (w,c) => println(\"\\\"\" + w + \"\\\"\" + \"\\t\" + c)}","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":6,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"Country","index":0,"aggr":"sum"}],"values":[{"name":"Downloads","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Country","index":0,"aggr":"sum"},"yAxis":{"name":"Downloads","index":1,"aggr":"sum"}}}},{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table5: String = \"\"\n"},{"type":"TABLE","data":"Country\tDownloads\n\"China\"\t4456076\n\"India\"\t3414582\n\"Iran\"\t2631035\n\"Russia\"\t1521434\n\"United States\"\t1150963\n\"Brazil\"\t1021540\n\"Egypt\"\t801106\n\"Indonesia\"\t780873\n\"N/A\"\t562692\n\"France\"\t511145\n"}]},"apps":[],"jobName":"paragraph_1507173703142_-1046720348","id":"20160830-185322_186078579","dateCreated":"2017-10-05T00:21:43-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:110","user":"anonymous","dateFinished":"2017-10-05T04:07:02-0300","dateStarted":"2017-10-05T04:07:02-0300"},{"title":"Top 10 - Articulos","text":"val table5 = \"\"\n\nprintln(\"%table DOI\\tTitle\\tYear\\tType\\tPublisher\\tBook\\tSubject\\tDownloads\\n\" + table5)\nDoiPlusMetadatos.foreach{case (d,t,y,ti,p,b,s,dow) => println(d + \"\\t\" + t + \"\\t\" + y + \"\\t\" + ti + \"\\t\" + p + \"\\t\" + b + \"\\t\" + s + \"\\t\" + dow)}","dateUpdated":"2017-10-05T04:04:18-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"DOI","index":0,"aggr":"sum"}],"values":[{"name":"Title","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"DOI","index":0,"aggr":"sum"},"yAxis":{"name":"Title","index":1,"aggr":"sum"}}}},{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"table5: String = \"\"\n"},{"type":"TABLE","data":"DOI\tTitle\tYear\tType\tPublisher\tBook\tSubject\tDownloads\n10.1007/978-1-4419-9716-6_11\tFull-scale modal wind turbine tests: comparing shaker excitation with wind excitation\t2011\tchapter\tSpringer New York\tStructural Dynamics and Renewable Energy, Volume 1\tNoMetadatosDisponibles\t7988\n10.1056/NEJMoa1402121\tComprehensive, Integrative Genomic Analysis of Diffuse Lower-Grade Gliomas\t2015\tarticle-journal\tNew England Journal of Medicine (NEJM/MMS)\tNew England Journal of Medicine\tGeneral Medicine\t6117\n10.1116/1.4904970\tPhotosensitive field emission study of SnS2 nanosheets\t2015\tarticle-journal\tAmerican Vacuum Society\tJournal of Vacuum Science & Technology B, Nanotechnology and Microelectronics: Materials, Processing, Measurement, and Phenomena\tInstrumentation\t2991\n10.1103/PhysRevB.63.224204\tGriffiths effects and quantum critical points in dirty superconductors without spin-rotation invariance: One-dimensional examples\t2001\tarticle-journal\tAmerican Physical Society (APS)\tPhysical Review B\tCondensed Matter Physics\t2890\n10.1182/asheducation-2015.1.8\tIron deficiency: new insights into diagnosis and treatment\t2015\tarticle-journal\tAmerican Society of Hematology\tHematology\tHematology\t2528\n10.4028/www.scientific.net/AMM.7-8.159\tMonitoring the Evolution of Fatigue in Corrugated Paperboard under Random Loads\t2007\tarticle-journal\tTrans Tech Publications\tApplied Mechanics and Materials\tNoMetadatosDisponibles\t2266\n10.1111/j.1365-277X.2004.00520.x\tIntentional mis-reporting of food consumption and its relationship with body mass index and psychological scores in women\t2004\tarticle-journal\tWiley-Blackwell\tJournal of Human Nutrition and Dietetics\tNutrition and Dietetics\t2241\n10.1002/pmic.200600525\tConifer defense against insects: Proteome analysis of Sitka spruce (Picea sitchensis) bark induced by mechanical wounding or feeding by white pine weevils (Pissodes strobi)\t2007\tarticle-journal\tWiley-Blackwell\tPROTEOMICS\tBiochemistry\t2168\n10.1161/CIRCRESAHA.117.306290\tEfficient Gene Disruption in Cultured Primary Human Endothelial Cells by CRISPR/Cas9Novelty and Significance\t2015\tarticle-journal\tOvid Technologies (Wolters Kluwer Health)\tCirculation Research\tPhysiology\t2001\n10.1002/smll.201002009\tGraphene-Based Materials: Synthesis, Characterization, Properties, and Applications\t2011\tarticle-journal\tWiley-Blackwell\tSmall\tBiotechnology\t1806\n"}]},"apps":[],"jobName":"paragraph_1507173703143_-1047105097","id":"20160814-113827_642005527","dateCreated":"2017-10-05T00:21:43-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:111","user":"anonymous","dateFinished":"2017-10-05T04:07:02-0300","dateStarted":"2017-10-05T04:07:02-0300"},{"text":"","dateUpdated":"2017-10-05T01:51:44-0300","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507173703144_-1049028841","id":"20160814-121759_363662491","dateCreated":"2017-10-05T00:21:43-0300","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:112","user":"anonymous"}],"name":"Laboratorio 1 - Conociendo a Sci-Hub","id":"2CUH63ZRH","angularObjects":{"2CVJ76BUE:shared_process":[],"2CX2H8CF4:shared_process":[],"2CVXZ1S9R:shared_process":[],"2CTYYMKA7:shared_process":[],"2CUYNFN2V:shared_process":[],"2CTZTDF67:shared_process":[],"2CUFQZDFF:shared_process":[],"2CVYS8BW2:shared_process":[],"2CUCN2Q7U:shared_process":[],"2CTRMSMU4:shared_process":[],"2CVTX9VNN:shared_process":[],"2CUQYDN8S:shared_process":[],"2CWSM4JR3:shared_process":[],"2CXFK9PQ3:shared_process":[],"2CVFWKTJA:shared_process":[],"2CU1X2671:shared_process":[],"2CURX7FN9:shared_process":[],"2CXGRW3NA:shared_process":[],"2CXDM4N7D:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}